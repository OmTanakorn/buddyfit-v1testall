{% extends '_base.html' %}
{% load static %}

{% block title %}Home page{% endblock title %}

{% block content %}

<div class="HQ_container">
  
  <div class="game-container" >
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.54.0/dist/phaser.min.js"></script>
    <div id="game-container" ></div>
    
    <script src="{% static 'js/game.js'%}"></script>
  </div>

  <!-- {% comment %} STUTS {% endcomment %} -->

  <div id="popup" class="popup">
    <div class="popup-content">
      <a class="close" id="x">x</a>
      <h2>Choose an option:</h2>
        <button id="pushup" class="popup-btn"><img src="../static/images/Str.png" style="transform: rotate(45deg);"><h5>Push up</h5></button>
        <button id="situp" class="popup-btn"><img src="../../static/images/End.png"><h5>Sit up</h5></button>
        <button id="squat" class="popup-btn"><img src="../../static/images/Agi.png" style="transform: rotate(15deg);"><h5>Squat</h5></button>
    </div>
  </div>

  <div class="buddies-container" style="margin-left: auto">
    {% for buddy in buddies %}
    <div class="BuddyFit">
      <h1>Buddy Fit</h1>
    </div>

    <div class="buddy-card">
      <h3>Name: {{ buddy.name }}</h3>
      <h3>Challenge mode</h3>
      <h4>&nbsp; &nbsp; Buddy high score: {{buddy.highScore}} </h4>
      <button class="rank-btn" onclick="leaderboard()">Ranking</button>
      <!-- <h4>&nbsp; &nbsp; Ranking: </h4> -->
    </div>
  
    <div class="status-container" >
      <h3>Training mode</h3>
      <div class="status-piece">
        <img src="../../static/images/Str.png" style="transform: rotate(45deg);">
        <div class="status-container">
          <h5>arm-power</h5>
          <div class="status-piece">
            <div class="experience-bar">
              <div id="arm-power-{{ buddy.id }}" class="experience-fill"></div>
              <div class="status-piece" style="justify-content: space-between;">
                <div id="arm-power-level{{ buddy.id }}"></div>
                <div id="arm-power-exp{{ buddy.id }}"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="status-piece">
        <img src="../../static/images/End.png" style="margin-top: 20px;">
        <div class="status-container">
          <h5>body-power</h5>
          <div class="status-piece">
            <div class="experience-bar">
              <div id="body-power-{{ buddy.id }}" class="experience-fill"></div>
              <div class="status-piece" style="justify-content: space-between;">
                <div id="body-power-level{{ buddy.id }}"></div>
                <div id="body-power-exp{{ buddy.id }}"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="status-piece">
        <img src="../../static/images/Agi.png" style="transform: rotate(15deg);">
        <div class="status-container">
          <h5>leg-power</h5>
          <div class="status-piece">
            <div class="experience-bar">
              <div id="leg-power-{{ buddy.id }}" class="experience-fill"></div>
              <div class="status-piece" style="justify-content: space-between;">
                <div id="leg-power-level{{ buddy.id }}"></div>
                <div id="leg-power-exp{{ buddy.id }}"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      // Get the power values for the current buddy
      const buddyName = '{{ buddy.name }}'
      var highScore = '{{buddy.highScore}}'
      var armPower = '{{ buddy.armpower }}';
      var legPower = '{{ buddy.legpower }}';
      var bodyPower = '{{ buddy.bodypower }}';
  
      // Calculate the level and EXP percentages for each power
      const armLevel = Math.floor(armPower / 10);
      const armExp = Math.floor(((armPower / 10) - armLevel) * 100);
      const bodyLevel = Math.floor(bodyPower / 10);
      const bodyExp = Math.floor(((bodyPower / 10) - bodyLevel )* 100);
      const legLevel = Math.floor(legPower / 10);
      const legExp = Math.floor(((legPower / 10) - legLevel) * 100);
      
      // Display the power values as level and % EXP
      
      const armPowerElem = document.getElementById("arm-power-{{ buddy.id }}");
      // armPowerElem.textContent = `EXP ${armExp}%`;
      const armWidthPercentage = Math.min(Math.max(armExp, 0), 100);
      armPowerElem.style.width = `${armWidthPercentage}%`;
      if (armWidthPercentage > 0) {
        armPowerElem.style.backgroundColor = `rgb(${255 - armWidthPercentage * 2.55}, ${armWidthPercentage * 2.55}, 0)`;
      } else {
        armPowerElem.style.backgroundColor = "#ddd";
      }
      
      const bodyPowerElem = document.getElementById("body-power-{{ buddy.id }}");
      // bodyPowerElem.textContent = `EXP ${bodyExp}%`;
      const bodyWidthPercentage = Math.min(Math.max(bodyExp, 0), 100);
      bodyPowerElem.style.width = `${bodyWidthPercentage}%`;
      if (bodyWidthPercentage > 0) {
          bodyPowerElem.style.backgroundColor = `rgb(${255 - bodyWidthPercentage * 2.55}, ${bodyWidthPercentage * 2.55}, 0)`;
      } else {
          bodyPowerElem.style.backgroundColor = "#ddd";
      }

      const legPowerElem = document.getElementById("leg-power-{{ buddy.id }}");
      // legPowerElem.textContent = `EXP ${legExp}%`;
      const legWidthPercentage = Math.min(Math.max(legExp, 0), 100);
      legPowerElem.style.width = `${legWidthPercentage}%`;
      if (legWidthPercentage > 0) {
          legPowerElem.style.backgroundColor = `rgb(${255 - legWidthPercentage * 2.55}, ${legWidthPercentage * 2.55}, 0)`;
      } else {
          legPowerElem.style.backgroundColor = "#ddd";
      }

      const armPowerElemExp = document.getElementById("arm-power-exp{{ buddy.id }}");
      armPowerElemExp.textContent = `${armExp}%`;
      const armPowerElemLevel = document.getElementById("arm-power-level{{ buddy.id }}");
      armPowerElemLevel.textContent = `LEVEL ${armLevel}`;

      const bodyPowerElemExp = document.getElementById("body-power-exp{{ buddy.id }}");
      bodyPowerElemExp.textContent = `${bodyExp}%`;
      const bodyPowerElemLevel = document.getElementById("body-power-level{{ buddy.id }}");
      bodyPowerElemLevel.textContent = `LEVEL ${bodyLevel}`;

      const legPowerElemExp = document.getElementById("leg-power-exp{{ buddy.id }}");
      legPowerElemExp.textContent = `${legExp}%`;
      const legPowerElemLevel = document.getElementById("leg-power-level{{ buddy.id }}");
      legPowerElemLevel.textContent = `LEVEL ${legLevel}`;

      function leaderboard() {
        window.location.href = '/leaderboard/';
      }    

      function redirectToChallenge() {
        // ใช้ window.location.href เพื่อเปลี่ยนพาท
        window.location.href = '/challenge/'; // หรือหากต้องการพาทอื่น ๆ คุณสามารถแก้ไขตามความเหมาะสม
      }    

      function showPopup() {
        // Show the popup
        document.getElementById("popup").style.display = "block";
      
        // Set onclick events for the buttons
        document.getElementById("pushup").onclick = function() {
          window.location.href = "/pushup"; // Redirect to option1 page
        };
        document.getElementById("situp").onclick = function() {
          window.location.href = "/situp"; // Redirect to option2 page
        };
        document.getElementById("squat").onclick = function() {
          window.location.href = "/squat"; // Redirect to option3 page
        };
        document.getElementById("x").onclick = function() {
          window.location.href = "/"; // Redirect to option3 page
        };
      }
    </script>

    <br />
    <button class="challenge-btn" onclick="redirectToChallenge()"><h1>Challenge</h1></button>
    <br />
    <br />
    <button class="train-btn" onclick="showPopup()"><h1>Train</h1></button>
  
    {% endfor %}
    
  </div>
{% endblock content %}
